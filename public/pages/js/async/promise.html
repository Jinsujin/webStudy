<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>

    <script>
      /**
       * Promise
       *
       * ë¹„ë™ê¸° ìˆ˜í–‰ì„ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í• ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ì˜¤ë¸Œì íŠ¸.
       * ë¹„ë™ê¸° ì²˜ë¦¬ ì—ì„œ ì½œë°±í•¨ìˆ˜ ëŒ€ì‹  ì‚¬ìš©
       *
       * ì •ìƒì ìœ¼ë¡œ ê¸°ëŠ¥ì´ ì„±ê³µë˜ì—ˆë‹¤ë©´, ì„±ê³µì˜ ë©”ì‹œì§€ -> ì²˜ë¦¬ê°’ ë¦¬í„´
       * ì‹¤íŒ¨í–ˆë‹¤ë©´, ì—ëŸ¬ ì „ë‹¬
       *
       * ìƒíƒœ: ìˆ˜í–‰ì¤‘pending -> ì„±ê³µì ìœ¼ë¡œ ì˜¤í¼ë ˆì´ì…˜ ëëƒ„ fulfilled / ë„¤íŠ¸ì›Œí¬ì— ë¬¸ì œê°€ ìƒê¹€ rejeacted
       * í”„ë¡œë“€ì„œ: ì •ë³´ì œê³µ
       * ì†Œë¹„ì : ì •ë³´ì†Œë¹„
       *
       */

      /**
       * 1. Producer ì •ë³´ì œê³µ
       * resolve : ê¸°ëŠ¥ì„ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰í•´ì„œ ê²°ê³¼ë¥¼ ì „ë‹¬í•´ì£¼ëŠ” í•¨ìˆ˜
       * reject : ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ê°€ ë¬¸ì œê°€ ìƒê¸°ë©´ í˜¸ì¶œí•˜ê²Œ ë 
       *
       * Promise ë¥¼ ë§Œë“¤ë©´, excutor í•¨ìˆ˜ê°€ ìë™ìœ¼ë¡œ ì‹¤í–‰ì´ ë¨
       */
      const promise = new Promise((resolve, reject) => {
        // ë¹„ë™ê¸° ì²˜ë¦¬ : ë„¤íŠ¸ì›Œí¬ ì²˜ë¦¬, íŒŒì¼ì½ê¸°ë“± ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì‘ì—…
        console.log("resolve running....");

        setTimeout(() => {
          // resolve('success'); // ì„±ê³µì ìœ¼ë¡œ ì²˜ë¦¬ ì™„ë£Œì‹œ, resolve ì½œë°±í•¨ìˆ˜ë¥¼ ì „ë‹¬

          reject(new Error("no network"));
        }, 2000);
      });

      /**
       * 2.Consumers : then , catch, finally
       * promise ê°€ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ì´ ë˜ê³ ë‚œ í›„, resolve ì½œë°±í•¨ìˆ˜ë¡œ ì „ë‹¬í•œ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤
      */
      promise
        .then(value => {
          // promise ìˆ˜í–‰ì´ ì„±ê³µí–ˆì„ë•Œ
          // ê°’ or promiseì „ë‹¬ ê°€ëŠ¥
          console.log(value);
        })
        .catch(error => {
          // promise ì—ì„œ ì‹¤íŒ¨í–ˆì„ë•Œ, ì—ëŸ¬ë©”ì‹œì§€ ì¶œë ¥
          console.log(error);
        })
        .finally(() => {
          // ì„±ê³µ, ì‹¤íŒ¨ ëª¨ë‘ ë“¤ì–´ì˜´
          console.log("finally");
        });

      /**
       * Promise Chaining
       *
       */

      const fetchNumber = new Promise((resolve, reject) => {
        // ì„œë²„í†µì‹ ì„ í–ˆë‹¤ê³  ê°€ì •í•˜ê³ , 1ì´ˆ ë’¤ì— ìˆ«ì ì „ë‹¬
        setTimeout(() => resolve(1), 1000);
      });

      fetchNumber
        .then(num => num * 2) // 1* 2 = 2
        .then(num => num + 5) // 2 + 5 = 7
        .then(num => {
          return new Promise((resolve, reject) => {
            setTimeout(() => resolve(num - 1), 1000); // 7 - 1 = 6
          });
        })
        .then(num => console.log(num));

      /**
       * Error Handling
       *
       * ê°ê° ì„œë²„ì—ì„œ ê°€ì ¸ì™€ì„œ ì²˜ë¦¬í•œë‹¤ê³  ê°€ì •.
       */

      const getChicken = () =>
        new Promise((resolve, reject) => {
          setTimeout(() => resolve("ğŸ”"), 1000);
        });

      const getMeat = chicken =>
        new Promise((resolve, reject) => {
        //   setTimeout(() => resolve(`${chicken} => ğŸ–`), 1000);
          setTimeout(() => reject(`${chicken} => ğŸ–`), 1000);
        });

      const cook = meat =>
        new Promise((resolve, reject) => {
          setTimeout(() => resolve(`${meat} => ğŸ¥˜`), 1000);
        });

      // getChicken()
      // .then(chicken => getMeat(chicken))
      // .then(meat => cook(meat))
      // .then(cook => console.log(cook));

      // ê²°ê³¼ê°’ì„ ê°€ì ¸ì™€ì„œ, ë‹¤ë¥¸í•¨ìˆ˜ë¥¼ ë°”ë¡œ í˜¸ì¶œí•˜ëŠ” ê²½ìš°ì—ëŠ” ì¸ìê°’ ìƒëµ ê°€ëŠ¥
      getChicken() //
        .then(getMeat) 
        .catch(error => { // ì¤‘ê°„ì— ì—ëŸ¬ê°€ ìƒê¸´ë‹¤ë©´, ì²˜ë¦¬í•  ì‘ì—…
            return 'ğŸ‘¨â€ğŸ³';
        })
        .then(cook)
        .then(console.log)
        .catch(console.log);
    </script>
  </head>
  <body></body>
</html>
